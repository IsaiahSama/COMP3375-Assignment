{% extends "base.html" %}

{% block title %}
Create Report
{% endblock %}

{% block content %}

<div id="centerContainer">
    <h1>Create Report</h1>

    <form action="">

        <div id="formBox" hx-get="/htmx/report/image-upload" hx-swap="innerHTML" hx-trigger="load">
            <!-- This will be populated as a component -->
        </div>

        <div id="buttons">
            <button id="cancelButton">Cancel</button>
            <button id="actionButton" hx-post="/report/image-upload">Next</button>
        </div>
    </form>

    <div id="locationUploadForm" hx-get="/htmx/report/location-upload" hx-target="#formBox"></div>
</div>

<script>

const actionButton = document.getElementById("actionButton")
const nextReq = document.getElementById('locationUploadForm')

const handleInitialSubmit = (event) => {
    
    if (event.detail.successful) {

        actionButton.textContent = "Submit"

        htmx.trigger(nextReq, 'click')
        
        actionButton.setAttribute('hx-post', '/report/location-upload')

        document.body.removeEventListener('htmx:afterRequest', handleInitialSubmit);
    }
}

const handleLocationSubmit = (event) => {

    if (event.detail.successful) {
        nextReq.setAttribute('hx-get', '/htmx/report/success')

        document.getElementById('buttons').innerHTML = "<a href='/'> <button> Return Home </button> </a>"
    }

    nextReq.click()

}

document.body.addEventListener('htmx:afterRequest', handleInitialSubmit);

</script>

{% endblock %}
