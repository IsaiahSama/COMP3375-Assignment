{% extends "base.html" %}

{% block title %}
Create Report
{% endblock %}

{% block content %}

<div id="centerContainer" class="flex flex-col items-center mt-5">
    <h1 class="md:text-4xl text-2xl font-bold">New Report</h1>

    <form action="">

        <div id="formBox" hx-get="/htmx/report/image-upload" hx-swap="innerHTML" hx-trigger="load">
            <!-- This will be populated as a component -->
        </div>

        <div id="buttons" class="flex gap-8 mt-5 lg:w-[30vw] md:w-[60vw] w-[80vw] justify-between">
            <button id="cancelButton" class="bg-gray-200 text-gray-600 px-5 py-1 rounded-sm w-1/2">Cancel</button>
            <button id="actionButton" hx-post="/report/image-upload" class="bg-[var(--blue-primary)] text-white px-5 py-1 rounded-sm w-1/2">Next</button>
        </div>
    </form>

    <div id="locationUploadForm" hx-get="/htmx/report/location-upload" hx-target="#formBox"></div>
</div>

<script>

const actionButton = document.getElementById("actionButton")
const nextReq = document.getElementById('locationUploadForm')

const handleInitialSubmit = (event) => {
    if (event.detail.successful && event.detail.requestConfig.method === 'POST') {

        actionButton.textContent = "Submit"

        htmx.trigger(nextReq, 'click')
        
        actionButton.setAttribute('hx-post', '/report/location-upload')

        document.body.removeEventListener('htmx:afterRequest', handleInitialSubmit);
    }
}

const handleLocationSubmit = (event) => {

    if (event.detail.successful && event.detail.requestConfig.method === "POST") {
        nextReq.setAttribute('hx-get', '/htmx/report/success')

        document.getElementById('buttons').innerHTML = "<a href='/'> <button> Return Home </button> </a>"
    }

    nextReq.click()

}

document.body.addEventListener('htmx:afterRequest', handleInitialSubmit);

</script>

{% endblock %}
